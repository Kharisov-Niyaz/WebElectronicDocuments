(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{214:function(t,e,a){"use strict";a.r(e);a(211),a(600),a(601),a(208),a(51);var s=a(7),n=a(472),i={props:["userId","docId"],data:function(){return{loading:!0,loadingSmall:!1,uploadDataModal:null,fileSelectedList:[]}},mounted:function(){var t=this;setTimeout((function(){t.uploadDataModal=M.Modal.init(t.$refs.uploadDataModal,{dismissible:!0})}),0),this.loading=!1},methods:{fileUpload:function(){var t=this;return Object(s.a)(regeneratorRuntime.mark((function e(){var a,s,i,r,o,c;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.fileSelectedList.length){e.next=3;break}return t.$error("Выберите файл для загрузки"),e.abrupt("return");case 3:a=new FormData,s="",i=Object(n.a)(t.fileSelectedList);try{for(i.s();!(r=i.n()).done;)o=r.value,a.append("files",o,o.name),s=o.name}catch(t){i.e(t)}finally{i.f()}return e.prev=7,t.loadingSmall=!0,c=t.docId,e.next=12,t.$store.dispatch("uploadData",{formData:a,docId:c});case 12:t.$emit("getFileName",s),t.$message("Загрузка прошла успешно"),e.next=18;break;case 16:e.prev=16,e.t0=e.catch(7);case 18:return e.prev=18,t.fileSelectedList=[],t.$refs.files.value="",t.$refs.filesText.value="",t.loadingSmall=!1,e.finish(18);case 24:case"end":return e.stop()}}),e,null,[[7,16,18,24]])})))()},fileSelected:function(t){this.fileSelectedList=t.target.files}},beforeDestroy:function(){this.uploadDataModal&&this.uploadDataModal.destroy&&this.uploadDataModal.destroy()}},r=a(18),o=Object(r.a)(i,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"uploadDataModal",staticClass:"modal modal-fixed-footer",attrs:{id:"uploadDataModal"}},[t._m(0),t._v(" "),t.loading?a("Loader"):a("div",[a("div",{staticClass:"modal-content"},[a("label",[t._v("Выберите файл")]),t._v(" "),a("div",{staticClass:"file-field input-field"},[a("div",{staticClass:"btn",class:{disabled:t.loadingSmall}},[a("i",{staticClass:"material-icons left"},[t._v("folder_open")]),t._v(" "),a("span",[t._v("Открыть")]),t._v(" "),a("input",{ref:"files",attrs:{type:"file",name:"files",multiple:""},on:{change:t.fileSelected}})]),t._v(" "),a("div",{staticClass:"file-path-wrapper"},[a("input",{ref:"filesText",staticClass:"file-path validate",attrs:{type:"text",placeholder:"Файлы"}})])]),t._v(" "),a("div",[a("button",{staticClass:"btn waves-effect waves-light",class:{disabled:t.loadingSmall},on:{click:t.fileUpload}},[t._v("\n                    Загрузить\n                    "),a("i",{staticClass:"material-icons right"},[t._v("file_download")])]),t._v(" "),t.loadingSmall?a("div",{staticClass:"progress"},[a("div",{staticClass:"indeterminate"})]):t._e()])]),t._v(" "),a("div",{staticClass:"modal-footer"},[a("a",{staticClass:"modal-close waves-effect waves-green btn-flat",attrs:{href:"#!"}},[a("i",{staticClass:"material-icons center"},[t._v("close")])])])])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-title center"},[e("h6",[this._v("Загрузка данных")])])}],!1,null,null,null).exports,c={props:["userId","docId","userListAll"],data:function(){return{loading:!1,journalModal:null,journalList:[]}},mounted:function(){var t=this;setTimeout((function(){var e,a=t;t.journalModal=M.Modal.init(t.$refs.journalModal,{dismissible:!0,onCloseEnd:function(){},onOpenStart:(e=Object(s.a)(regeneratorRuntime.mark((function t(){var e,s;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(e=a.docId)){t.next=15;break}return t.prev=2,a.loading=!0,s=e,t.next=7,a.$store.dispatch("getDocJournalList",{docId:s});case 7:a.journalList=t.sent,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(2);case 12:return t.prev=12,a.loading=!1,t.finish(12);case 15:case"end":return t.stop()}}),t,null,[[2,10,12,15]])}))),function(){return e.apply(this,arguments)})})}),0)},methods:{},beforeDestroy:function(){this.journalModal&&this.journalModal.destroy&&this.journalModal.destroy()}},l=Object(r.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"journalModal",staticClass:"modal modal-fixed-footer",attrs:{id:"journalModal"}},[t._m(0),t._v(" "),t.loading?a("Loader"):a("div",[a("div",{staticClass:"modal-content"},[a("table",{staticClass:"highlight responsive-table"},[a("thead",[a("tr",[a("th",[t._v("#")]),t._v(" "),a("th",[t._v("Сообщение")]),t._v(" "),a("th",[t._v("Тип")]),t._v(" "),a("th",[t._v("Пользователь")]),t._v(" "),a("th",[t._v("Дата")])])]),t._v(" "),a("tbody",t._l(t.journalList,(function(e,s){return a("tr",{key:e.id,class:{"deep-purple lighten-5 black-text":1==e.eventType}},[a("td",[t._v(t._s(++s))]),t._v(" "),a("td",[t._v(t._s(e.message))]),t._v(" "),a("td",[0==e.eventType?a("i",{staticClass:"material-icons left rotate"},[t._v("reply")]):t._e(),t._v(" "),1==e.eventType?a("i",{staticClass:"material-icons left"},[t._v("reply")]):t._e(),t._v(" "),2==e.eventType?a("i",{staticClass:"material-icons left"},[t._v("insert_drive_file")]):t._e(),t._v(" "),3==e.eventType?a("i",{staticClass:"material-icons left"},[t._v("file_upload")]):t._e(),t._v(" "),4==e.eventType?a("i",{staticClass:"material-icons left"},[t._v("error_outline")]):t._e(),t._v(" "),5==e.eventType?a("i",{staticClass:"material-icons left"},[t._v("person")]):t._e(),t._v(" "),a("b",{class:{"green-text":0==e.eventType,"red-text":1==e.eventType,"blue-text":0!=e.eventType&&1!=e.eventType}},[0==e.eventType?a("strong",[t._v("Перевод")]):t._e(),t._v(" "),1==e.eventType?a("strong",[t._v("Возрат")]):t._e(),t._v(" "),0!=e.eventType&&1!=e.eventType?a("strong",[t._v("Сообщение")]):t._e()])]),t._v(" "),a("td",[t._v(t._s(t.userListAll[e.userId]))]),t._v(" "),a("td",[t._v(t._s(t._f("date")(e.createDate,"datetime")))])])})),0)])]),t._v(" "),a("div",{staticClass:"modal-footer"},[a("a",{staticClass:"modal-close waves-effect waves-green btn-flat",attrs:{href:"#!"}},[a("i",{staticClass:"material-icons center"},[t._v("close")])])])])],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-title center"},[e("h6",[this._v("Журнал документа")])])}],!1,null,null,null).exports,d={props:["question"],data:function(){return{questionModal:null}},mounted:function(){var t=this;setTimeout((function(){t.questionModal=M.Modal.init(t.$refs.questionModal,{dismissible:!0})}),0)},methods:{questionClick:function(t){this.$emit("questionClick",t)}},beforeDestroy:function(){this.questionModal&&this.questionModal.destroy&&this.questionModal.destroy()}},u=Object(r.a)(d,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{ref:"questionModal",staticClass:"modal modal-fixed-footer",attrs:{id:"questionModal"}},[t._m(0),t._v(" "),a("div",[a("div",{staticClass:"modal-content center"},[a("h6",{domProps:{innerHTML:t._s(t.question.text)}}),t._v(" "),a("div",{staticStyle:{padding:"25px"}},[a("div",{staticClass:"btn-group",attrs:{role:"group"}},[a("a",{staticClass:"modal-close waves-effect waves-light btn",attrs:{href:"#!"},on:{click:function(e){return e.preventDefault(),t.questionClick(!0)}}},[a("i",{staticClass:"medium material-icons left"},[t._v("done")]),t._v(" "),a("span",[t._v("Да")])]),t._v(" "),a("a",{staticClass:"modal-close waves-effect waves-light btn",attrs:{href:"#!"},on:{click:function(e){return e.preventDefault(),t.questionClick(!1)}}},[a("i",{staticClass:"medium material-icons left"},[t._v("do_not_disturb")]),t._v(" "),a("span",[t._v("Нет")])])])])])])])}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"modal-title center"},[e("br"),this._v(" "),e("i",{staticClass:"medium material-icons"},[this._v("error_outline")])])}],!1,null,null,null).exports,v={mixins:[a(446).a],data:function(){return{loading:!0,loadingSmall:!1,userId:0,userStage:0,userHead:!1,docId:0,signType:0,searchDoc:"",question:{},dataList:[],stageList:[],userList:[],userListAll:[]}},metaInfo:function(){return{title:"Главная страница"}},computed:{dataListTask:function(){var t=this;return this.dataList.filter((function(e){return!t.searchDoc||-1!==e.name.toUpperCase().indexOf(t.searchDoc.toUpperCase())}))}},mounted:function(){var t=this;return Object(s.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.userId=t.$store.getters.userId,t.userStage=t.$store.getters.userInfo.stageId,t.userHead=t.$store.getters.userHead,t.stageList=t.$store.getters.stages,t.userList=t.$store.getters.users,t.userListAll=t.$store.getters.usersAll,e.next=9,t.getDocsList();case 9:t.dataList=e.sent,t.$notification.show("Hello World",{body:"This is an example!"},{}),e.next=15;break;case 13:e.prev=13,e.t0=e.catch(0);case 15:return e.prev=15,t.loading=!1,e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[0,13,15,18]])})))()},methods:{uploadDataClick:function(t){this.docId=t},getFileName:function(t){if(t){var e=this.docId;try{var a=this.dataList.findIndex((function(t){return t.id===e}));this.dataList[a].docAction.fileName=t}catch(t){}}},signDocClick:function(t,e){this.docId=t,this.signType=e,this.question={text:e>0?"Вы уверены, что хотите <b>подписать</b> документ?":"Вы уверены, что хотите <b>вернуть</b> документ?"}},questionClick:function(t){var e=this;return Object(s.a)(regeneratorRuntime.mark((function a(){var s,n,i;return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!t){a.next=14;break}return s=e.docId,n=e.signType,a.prev=3,i=e.dataList.findIndex((function(t){return t.id===s})),a.next=7,e.$store.dispatch("setDocNewStage",{docId:s,newStage:n});case 7:3==e.userStage&&n<0?e.dataList[i].docAction.stageId=1:e.dataList[i].docAction.stageId+=n,e.dataList[i].docAction.update=!0,e.$message("Успешная смена этапа"),a.next=14;break;case 12:a.prev=12,a.t0=a.catch(3);case 14:case"end":return a.stop()}}),a,null,[[3,12]])})))()},changeDocUrgency:function(t,e){var a=this;return Object(s.a)(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,a.$store.dispatch("setDocUrgency",{docId:t,urgencyVal:e});case 3:s.next=7;break;case 5:s.prev=5,s.t0=s.catch(0);case 7:case"end":return s.stop()}}),s,null,[[0,5]])})))()},downloadDocFile:function(t,e){var a=this;return Object(s.a)(regeneratorRuntime.mark((function s(){return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,a.$store.dispatch("downloadDocFile",{docId:t,fileName:e});case 3:s.next=7;break;case 5:s.prev=5,s.t0=s.catch(0);case 7:case"end":return s.stop()}}),s,null,[[0,5]])})))()},changeDocNormalInspection:function(t,e){var a=this;return Object(s.a)(regeneratorRuntime.mark((function s(){var n;return regeneratorRuntime.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,n=a.dataList.findIndex((function(e){return e.id===t})),s.next=4,a.$store.dispatch("setDocNormalInspection",{docId:t});case 4:a.dataList[n].docAction.normalInspectionId=e.target.checked?a.userId:0,a.$message("Успешно сохранено"),s.next=10;break;case 8:s.prev=8,s.t0=s.catch(0);case 10:case"end":return s.stop()}}),s,null,[[0,8]])})))()}},components:{Upload:o,Journal:l,Question:u}},f=Object(r.a)(v,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[t._m(0),t._v(" "),t.loading?a("Loader"):a("div",{staticClass:"row"},[a("Question",{attrs:{question:t.question},on:{questionClick:t.questionClick}}),t._v(" "),a("Upload",{attrs:{userId:t.userId,docId:t.docId},on:{getFileName:t.getFileName}}),t._v(" "),a("Journal",{attrs:{userId:t.userId,docId:t.docId,userListAll:t.userListAll}}),t._v(" "),a("div",{staticClass:"input-field col s12 m12 l12"},[a("i",{staticClass:"material-icons prefix"},[t._v("search")]),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.searchDoc,expression:"searchDoc"}],attrs:{type:"text",id:"searchInput"},domProps:{value:t.searchDoc},on:{input:function(e){e.target.composing||(t.searchDoc=e.target.value)}}}),t._v(" "),a("label",{attrs:{for:"searchInput"}},[t._v("Поиск")])]),t._v(" "),t.loadingSmall?a("div",{staticClass:"progress"},[a("div",{staticClass:"indeterminate"})]):t._e(),t._v(" "),a("div",{staticClass:"col s12 m12 l12"},t._l(t.dataListTask,(function(e,s){return a("div",{key:e.id,staticClass:"card grey lighten-5 z-depth-2"},[a("div",{staticClass:"card-text waves-effect waves-block waves-light"},[e.docAction.update?a("span",{staticClass:"badge white-text green left",attrs:{"data-badge-caption":"обновлено"}}):t._e(),t._v(" "),e.docAction.urgency?a("span",{staticClass:"badge white-text red left",attrs:{"data-badge-caption":"срочно"}}):t._e(),t._v(" "),2==t.userStage&&e.docAction.normalInspectionId>0?a("span",{staticClass:"badge white-text lime left",attrs:{"data-badge-caption":"закреплен"}}):t._e(),t._v(" "),a("span",{staticClass:"badge white-text",class:t.stageList[e.docAction.stageId].Color,attrs:{"data-badge-caption":t.stageList[e.docAction.stageId].Name}})]),t._v(" "),a("div",{staticClass:"card-content"},[a("p",{staticClass:"card-title activator grey-text text-darken-4"},[a("b",[t._v(t._s(e.customer))])]),a("hr"),t._v(" "),a("b",[t._v(t._s(e.name))]),t._v(" "),a("i",{staticClass:"material-icons right"},[t._v("more_vert")]),t._v(" "),a("p"),t._v(" "),a("p",[a("i",[t._v("Исполнитель: "),a("b",[t._v(t._s(e.executor))])])]),t._v(" "),t.userHead||1!=t.userStage?a("p",[a("i",[t._v("Сотрудник: "),a("b",[t._v(t._s(e.initiatorName))])])]):t._e(),t._v(" "),e.docAction.normalInspectionId?a("p",[a("i",[t._v("Нормоконтроль: "),a("b",[t._v(t._s(t.userListAll[e.docAction.normalInspectionId]))])])]):t._e(),t._v(" "),a("p",[a("i",[t._v("Дата создания:"),a("b",[t._v(t._s(t._f("date")(e.createDate,"date")))])])]),t._v(" "),a("p",[a("i",[t._v("Дата завершения:"),a("b",[t._v(t._s(t._f("date")(e.closeDate,"date")))])])]),t._v(" "),a("p",[a("label",[a("input",{attrs:{type:"checkbox",onclick:"this.checked=!this.checked;"},domProps:{checked:e.payment}}),t._v(" "),a("span",[t._v("Договор оплачен")])])])]),t._v(" "),a("div",{staticClass:"card-reveal"},[a("span",{staticClass:"card-title grey-text text-darken-4"},[t._v(" "+t._s(e.name)),a("i",{staticClass:"material-icons right"},[t._v("close")])]),t._v(" "),a("p",[t._v(t._s(e.description))])]),t._v(" "),a("div",{staticClass:"card-action"},[a("div",{staticStyle:{padding:"5px"}},[a("div",{staticClass:"btn-group",attrs:{role:"group"}},[a("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Скачать документ",expression:"'Скачать документ'"}],staticClass:"waves-effect waves-light btn",attrs:{disabled:!e.docAction.fileName,href:"#!",download:""},on:{click:function(a){return a.preventDefault(),t.downloadDocFile(e.id,e.docAction.fileName)}}},[a("i",{staticClass:"medium material-icons"},[t._v("insert_drive_file")])]),t._v(" "),a("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Загрузка документа",expression:"'Загрузка документа'"}],staticClass:"waves-effect waves-light btn modal-trigger",attrs:{href:"#uploadDataModal"},on:{click:function(a){return a.preventDefault(),t.uploadDataClick(e.id)}}},[a("i",{staticClass:" medium material-icons"},[t._v("file_upload")]),t._v(" "),a("span")]),t._v(" "),a("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Статистика документа",expression:"'Статистика документа'"}],staticClass:"waves-effect waves-light btn modal-trigger",attrs:{href:"#journalModal"},on:{click:function(a){return a.preventDefault(),t.uploadDataClick(e.id)}}},[a("i",{staticClass:"medium material-icons"},[t._v("format_list_bulleted")]),t._v(" "),a("span")]),t._v(" "),a("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Возврат документа",expression:"'Возврат документа'"}],staticClass:"waves-effect waves-light btn modal-trigger",attrs:{href:"#questionModal",disabled:e.docAction.stageId!=t.userStage||1==t.userStage},on:{click:function(a){return a.preventDefault(),t.signDocClick(e.id,-1)}}},[a("i",{staticClass:"medium material-icons"},[t._v("reply")]),t._v(" "),a("span")]),t._v(" "),a("a",{directives:[{name:"tooltip",rawName:"v-tooltip",value:"Перевод документа",expression:"'Перевод документа'"}],staticClass:"waves-effect waves-light btn  modal-trigger",attrs:{href:"#questionModal",disabled:e.docAction.stageId!=t.userStage},on:{click:function(a){return a.preventDefault(),t.signDocClick(e.id,1)}}},[a("i",{staticClass:"medium material-icons rotate"},[t._v("reply")]),t._v(" "),a("span")])]),t._v(" "),1==t.userStage?a("div",{staticClass:"switch right"},[a("label",[a("input",{directives:[{name:"model",rawName:"v-model",value:e.docAction.urgency,expression:"item.docAction.urgency"}],attrs:{disabled:!t.userHead,type:"checkbox"},domProps:{checked:Array.isArray(e.docAction.urgency)?t._i(e.docAction.urgency,null)>-1:e.docAction.urgency},on:{change:[function(a){var s=e.docAction.urgency,n=a.target,i=!!n.checked;if(Array.isArray(s)){var r=t._i(s,null);n.checked?r<0&&t.$set(e.docAction,"urgency",s.concat([null])):r>-1&&t.$set(e.docAction,"urgency",s.slice(0,r).concat(s.slice(r+1)))}else t.$set(e.docAction,"urgency",i)},function(a){return t.changeDocUrgency(e.id,e.docAction.urgency)}]}}),t._v(" "),a("span",{staticClass:"lever"}),t._v(" "),a("b",[t._v("Срочно")])])]):t._e(),t._v(" "),2==t.userStage?a("div",{staticClass:"switch right"},[a("label",[a("input",{attrs:{disabled:t.userId!=e.docAction.normalInspectionId&&e.docAction.normalInspectionId>0,type:"checkbox"},domProps:{checked:e.docAction.normalInspectionId>0},on:{change:function(a){return t.changeDocNormalInspection(e.id,a)}}}),t._v(" "),a("span",{staticClass:"lever"}),t._v(" "),a("b",[t._v("Закрепить")])])]):t._e()])])])})),0)],1)],1)}),[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"page-title"},[e("h3",[this._v("Список задач")])])}],!1,null,null,null);e.default=f.exports},446:function(t,e,a){"use strict";a(51);var s=a(7);e.a={methods:{getDocsList:function(){var t=this;return Object(s.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$store.dispatch("getDocsList");case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)})))()},getSearchDocsList:function(t){var e=this;return Object(s.a)(regeneratorRuntime.mark((function a(){return regeneratorRuntime.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.$store.dispatch("getSearchDocsList",t);case 2:return a.abrupt("return",a.sent);case 3:case"end":return a.stop()}}),a)})))()}}}},472:function(t,e,a){"use strict";function s(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,s=new Array(e);a<e;a++)s[a]=t[a];return s}function n(t){if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(t=function(t,e){if(t){if("string"==typeof t)return s(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);return"Object"===a&&t.constructor&&(a=t.constructor.name),"Map"===a||"Set"===a?Array.from(a):"Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?s(t,e):void 0}}(t))){var e=0,a=function(){};return{s:a,n:function(){return e>=t.length?{done:!0}:{done:!1,value:t[e++]}},e:function(t){throw t},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var n,i,r=!0,o=!1;return{s:function(){n=t[Symbol.iterator]()},n:function(){var t=n.next();return r=t.done,t},e:function(t){o=!0,i=t},f:function(){try{r||null==n.return||n.return()}finally{if(o)throw i}}}}a.d(e,"a",(function(){return n}))},600:function(t,e,a){"use strict";var s=a(30),n=a(136).findIndex,i=a(142),r=!0;"findIndex"in[]&&Array(1).findIndex((function(){r=!1})),s({target:"Array",proto:!0,forced:r},{findIndex:function(t){return n(this,t,arguments.length>1?arguments[1]:void 0)}}),i("findIndex")},601:function(t,e,a){"use strict";var s=a(30),n=a(139).indexOf,i=a(209),r=[].indexOf,o=!!r&&1/[1].indexOf(1,-0)<0,c=i("indexOf");s({target:"Array",proto:!0,forced:o||c},{indexOf:function(t){return o?r.apply(this,arguments)||0:n(this,t,arguments.length>1?arguments[1]:void 0)}})}}]);